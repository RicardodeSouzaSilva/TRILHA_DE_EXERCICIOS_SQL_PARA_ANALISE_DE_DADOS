/**********************************************************************************************
ðŸŽ¯ TRILHA DE EXERCÃCIOS â€” SQL PARA ANÃLISE (PostgreSQL)
Tabelas: clientes (C), pedidos (P), produtos (PR)
Aliases sugeridos: C = clientes, P = pedidos, PR = produtos
Dicas: preferir filtros sargÃ¡veis em datas; escolher Ã¢ncora conforme o enunciado; usar DISTINCT quando houver possÃ­vel duplicidade.
**********************************************************************************************/

-- ============================================================================================
-- ðŸ§© NÃVEL 1 â€” FUNDAMENTOS (JOINs, DISTINCT, filtros bÃ¡sicos)
-- ============================================================================================

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 1 â€” Pedidos com cliente e produto
Enunciado: Liste todos os pedidos com nome do cliente e nome do produto.
InterpretaÃ§Ã£o: â€œpedidosâ€ implica existir em P â†’ Ã¢ncora em P com INNER JOIN em C e PR. Ordene por data.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:

-- Seleciona as colunas desejadas das tabelas cliente, produto e pedido
select
    tab_cliente.nome_cliente,     -- Nome do cliente
    tab_produto.nome_produto,     -- Nome do produto
    tab_pedido.id_pedido,         -- CÃ³digo/ID do pedido
    tab_pedido.data_pedido,       -- Data em que o pedido foi realizado
    tab_pedido.valor_pedido       -- Valor total do pedido
-- Define a tabela principal da consulta (clientes)
from cap09.clientes as tab_cliente
-- Faz o INNER JOIN com a tabela de pedidos,
-- relacionando cliente -> pedido (id do cliente)
inner join cap09.pedidos as tab_pedido
    on tab_cliente.id_cli = tab_pedido.id_cliente
-- Faz o INNER JOIN com a tabela de produtos,
-- relacionando pedido -> produto (id do produto)
inner join cap09.produtos as tab_produto
    on tab_produto.id_prod = tab_pedido.id_produto;




/*--------------------------------------------------------------------------------------------
ExercÃ­cio 2 â€” Todos os clientes, mesmo sem pedido
Enunciado: Liste todos os clientes e o id do pedido (se houver).
InterpretaÃ§Ã£o: todos os clientes devem aparecer â†’ Ã¢ncora em C + LEFT JOIN em P. Trate NULL como â€œsem pedidoâ€.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
select
    tab_cliente.nome_cliente,  -- Nome do cliente
    -- Se o produto nÃ£o existir (caso nÃ£o haja pedido), retorna 'Sem produto'
    COALESCE(tab_produto.nome_produto, 'Sem produto') as nome_produto,
    -- Se o ID do pedido for nulo, retorna 0
    COALESCE(tab_pedido.id_pedido, 0) as id_pedido,
    -- Tratamento especial para a data:
    -- Se nÃ£o houver data (NULL), retorna 'Sem data'.
    -- Caso exista, converte a data para texto no formato YYYY-MM-DD.
    CASE 
        WHEN tab_pedido.data_pedido IS NULL THEN 'Sem data'
        ELSE to_char(tab_pedido.data_pedido, 'YYYY-MM-DD')
    END AS data_pedido_info,
    -- Se o valor do pedido estiver NULL, retorna 0
    COALESCE(tab_pedido.valor_pedido, 0) as valor_pedido
-- Define a tabela principal da consulta:
-- Todos os clientes serÃ£o retornados, independentemente de terem realizado pedidos.
from cap09.clientes as tab_cliente
-- LEFT JOIN: traz os pedidos quando existirem.
-- Caso o cliente nÃ£o tenha pedido, os campos do pedido virÃ£o como NULL.
left join cap09.pedidos as tab_pedido
    on tab_cliente.id_cli = tab_pedido.id_cliente
-- LEFT JOIN: traz informaÃ§Ãµes do produto vinculado ao pedido.
-- Se nÃ£o houver pedido ou produto, as colunas virÃ£o como NULL.
left join cap09.produtos as tab_produto
    on tab_produto.id_prod = tab_pedido.id_produto
-- Organiza o resultado pela ordem alfabÃ©tica do nome do cliente
order by nome_cliente;



/*--------------------------------------------------------------------------------------------
ExercÃ­cio 3 â€” Par clienteÃ—produto vendido (sem duplicar)
Enunciado: Traga os pares (cliente, produto) que jÃ¡ tiveram pelo menos uma venda, sem duplicatas.
InterpretaÃ§Ã£o: base em P; deduplicar com DISTINCT se houver mÃºltiplos pedidos do mesmo par.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
select
    distinct tab_cliente.nome_cliente,   -- DISTINCT: remove linhas duplicadas considerando TODAS as colunas selecionadas.
                                         -- Ou seja, sÃ³ elimina duplicatas se nome_cliente, nome_produto e id_pedido 
                                         -- forem iguais na mesma linha.
    tab_produto.nome_produto,            -- Nome do produto associado ao pedido
    tab_pedido.id_pedido                 -- ID do pedido realizado pelo cliente
-- Tabela principal da consulta: clientes
from cap09.clientes as tab_cliente
-- INNER JOIN com pedidos:
-- Retorna apenas clientes que tÃªm pedidos registrados.
inner join cap09.pedidos as tab_pedido
    on tab_cliente.id_cli = tab_pedido.id_cliente
-- INNER JOIN com produtos:
-- Retorna apenas pedidos que tÃªm um produto associado.
inner join cap09.produtos as tab_produto
    on tab_produto.id_prod = tab_pedido.id_produto
-- Ordena o resultado final pelo nome do cliente
order by tab_cliente.nome_cliente;



/*--------------------------------------------------------------------------------------------
ExercÃ­cio 4 â€” Pedidos por intervalo de datas (sargÃ¡vel)
Enunciado: Liste pedidos (com cliente e produto) entre duas datas especÃ­ficas (inclusive).
InterpretaÃ§Ã£o: filtro sargÃ¡vel em P.data_pedido usando >= e <=; evitar funÃ§Ã£o na coluna.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

-- ============================================================================================
-- ðŸ§© NÃVEL 2 â€” AGREGAÃ‡Ã•ES, ORDENAÃ‡ÃƒO INTELIGENTE, ANTI-JOIN
-- ============================================================================================

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 5 â€” MÃ©dia do valor por cidade (incluindo sem pedidos)
Enunciado: Calcule a mÃ©dia de valor_pedido por cidade, incluindo cidades sem pedidos (mostrar â€œNÃ£o Houve Pedidoâ€).
InterpretaÃ§Ã£o: manter todas as cidades â†’ Ã¢ncora C + LEFT JOIN P; CASE na projeÃ§Ã£o e regra de ordenaÃ§Ã£o (quem tem mÃ©dia vem antes).
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 6 â€” Soma de vendas por estado (filtro IN)
Enunciado: Traga a soma de valor_pedido por estado do cliente, apenas para um conjunto especÃ­fico (ex.: RJ e SP).
InterpretaÃ§Ã£o: JOIN CÃ—P e WHERE estado_cliente IN (...); ordenar do maior para o menor.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 7 â€” Clientes sem nenhum pedido (anti-join)
Enunciado: Liste apenas os clientes que nunca fizeram pedido.
InterpretaÃ§Ã£o: NOT EXISTS contra P para detectar ausÃªncia de pedidos por cliente.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 8 â€” Ticket mÃ©dio por estado (zeros para ausÃªncia)
Enunciado: Calcule o ticket mÃ©dio (AVG(valor_pedido)) por estado, exibindo 0 quando nÃ£o houver vendas.
InterpretaÃ§Ã£o: preservar todos os estados (C como base) com JOIN apropriado e COALESCE/CASE para substituir NULL por 0.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

-- ============================================================================================
-- ðŸ§© NÃVEL 3 â€” COMPOSIÃ‡Ã•ES, TOP N, DEDUP E DATAWARENESS
-- ============================================================================================

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 9 â€” Produtos e nÃºmero de pedidos (inclua produtos sem pedido)
Enunciado: Liste cada produto e o nÂº de pedidos associados; produtos sem pedido devem aparecer com contagem 0.
InterpretaÃ§Ã£o: Ã¢ncora PR + LEFT JOIN P; COUNT de P.id_pedido e COALESCE; ordenar por contagem desc.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 10 â€” Top 3 cidades por volume vendido
Enunciado: Traga as 3 cidades com maior soma de valor_pedido.
InterpretaÃ§Ã£o: JOIN CÃ—P, agregaÃ§Ã£o por cidade, ORDER BY SUM(...) DESC e LIMIT 3.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 11 â€” Receita por produto e ano (sargÃ¡vel)
Enunciado: Some o valor_pedido por produto para um determinado ano (ex.: 2024), mostrando produto e total.
InterpretaÃ§Ã£o: filtro sargÃ¡vel por faixa de data (ex.: >= '2024-01-01' e < '2025-01-01'); evitar EXTRACT na coluna.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

/*--------------------------------------------------------------------------------------------
ExercÃ­cio 12 â€” Clientes â€œativosâ€ no perÃ­odo (DISTINCT)
Enunciado: Liste os clientes que fizeram pelo menos 1 pedido em um perÃ­odo; nÃ£o repita cliente.
InterpretaÃ§Ã£o: base em P; filtrar por data sargÃ¡vel; projetar cliente com DISTINCT.
--------------------------------------------------------------------------------------------*/
-- SUA QUERY AQUI:
/*



*/

-- ============================================================================================
-- âœ… CHECKLIST RÃPIDO PARA CADA SOLUÃ‡ÃƒO
-- â€¢ Usou a Ã¢ncora correta? (quem â€œtem que aparecerâ€ fica no FROM)
-- â€¢ O filtro de data estÃ¡ sargÃ¡vel (faixa com >= / < ou <=)?
-- â€¢ Precisava DISTINCT para evitar duplicaÃ§Ã£o?
-- â€¢ OrdenaÃ§Ã£o estÃ¡ coerente com o enunciado (e com NULLS FIRST/LAST se necessÃ¡rio)?
-- â€¢ FunÃ§Ãµes em colunas indexadas foram evitadas no WHERE?
-- â€¢ CASE/COALESCE para apresentar â€œNÃ£o Houve Pedidoâ€ ou 0 quando pedido ausente?
-- ============================================================================================
```
